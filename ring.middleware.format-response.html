<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>ring.middleware.format-response documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Ring-middleware-format 0.5.0 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ring</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></div></li><li class="depth-3 branch"><a href="ring.middleware.format.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>format</span></div></a></li><li class="depth-3 branch"><a href="ring.middleware.format-params.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>format-params</span></div></a></li><li class="depth-3 current"><a href="ring.middleware.format-response.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>format-response</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="ring.middleware.format-response.html#var-available-charsets"><div class="inner"><span>available-charsets</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-can-encode.3F"><div class="inner"><span>can-encode?</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-choose-charset"><div class="inner"><span>choose-charset</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-choose-charset*"><div class="inner"><span>choose-charset*</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-default-charset-extractor"><div class="inner"><span>default-charset-extractor</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-default-handle-error"><div class="inner"><span>default-handle-error</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-make-encoder"><div class="inner"><span>make-encoder</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-parse-accept-header"><div class="inner"><span>parse-accept-header</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-parse-accept-header*"><div class="inner"><span>parse-accept-header*</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-parse-charset-accepted"><div class="inner"><span>parse-charset-accepted</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-preferred-charset"><div class="inner"><span>preferred-charset</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-preferred-encoder"><div class="inner"><span>preferred-encoder</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-wrap-clojure-response"><div class="inner"><span>wrap-clojure-response</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-wrap-format-response"><div class="inner"><span>wrap-format-response</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-wrap-json-response"><div class="inner"><span>wrap-json-response</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-wrap-restful-response"><div class="inner"><span>wrap-restful-response</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-wrap-transit-json-response"><div class="inner"><span>wrap-transit-json-response</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-wrap-transit-msgpack-response"><div class="inner"><span>wrap-transit-msgpack-response</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-wrap-yaml-in-html-response"><div class="inner"><span>wrap-yaml-in-html-response</span></div></a></li><li class="depth-1"><a href="ring.middleware.format-response.html#var-wrap-yaml-response"><div class="inner"><span>wrap-yaml-response</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">ring.middleware.format-response</h2><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-available-charsets"><h3>available-charsets</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Set of recognised charsets by the current JVM</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L15">view source</a></div></div><div class="public anchor" id="var-can-encode.3F"><h3>can-encode?</h3><div class="usage"><code>(can-encode? {:keys [enc-type], :as encoder} {:keys [type sub-type], :as accepted-type})</code></div><div class="doc"><div class="markdown"><p>Check whether encoder can encode to accepted-type. Accepted-type should have keys <em>:type</em> and <em>:sub-type</em> with appropriate values.</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L30">view source</a></div></div><div class="public anchor" id="var-choose-charset"><h3>choose-charset</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Memoized form of <a href="ring.middleware.format-response.html#var-choose-charset*">choose-charset*</a></p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L147">view source</a></div></div><div class="public anchor" id="var-choose-charset*"><h3>choose-charset*</h3><div class="usage"><code>(choose-charset* accept-charset)</code></div><div class="doc"><div class="markdown"><p>Returns an useful charset from the accept-charset string. Defaults to utf-8</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L140">view source</a></div></div><div class="public anchor" id="var-default-charset-extractor"><h3>default-charset-extractor</h3><div class="usage"><code>(default-charset-extractor request)</code></div><div class="doc"><div class="markdown"><p>Default charset extractor, which returns either <em>Accept-Charset</em> header field or <em>utf-8</em></p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L151">view source</a></div></div><div class="public anchor" id="var-default-handle-error"><h3>default-handle-error</h3><div class="usage"><code>(default-handle-error e _ _)</code></div><div class="doc"><div class="markdown"><p>Default error handling function used, which rethrows the Exception</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L135">view source</a></div></div><div class="public anchor" id="var-make-encoder"><h3>make-encoder</h3><div class="usage"><code>(make-encoder encoder content-type binary?)</code><code>(make-encoder encoder content-type)</code></div><div class="doc"><div class="markdown"><p>Return a encoder map suitable for <a href="null">wrap-format-response.</a> f takes a string and returns an encoded string type <em>Content-Type</em> of the encoded string (make-encoder json/generate-string &ldquo;application/json&rdquo;)</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L123">view source</a></div></div><div class="public anchor" id="var-parse-accept-header"><h3>parse-accept-header</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Memoized form of <a href="ring.middleware.format-response.html#var-parse-accept-header*">parse-accept-header*</a></p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L78">view source</a></div></div><div class="public anchor" id="var-parse-accept-header*"><h3>parse-accept-header*</h3><div class="usage"><code>(parse-accept-header* accept-header)</code></div><div class="doc"><div class="markdown"><p>Parse Accept headers into a sorted sequence of maps. &ldquo;application/json;level=1;q=0.4&rdquo; =&gt; ({:type &ldquo;application&rdquo; :sub-type &ldquo;json&rdquo;  :q 0.4 :parameter &ldquo;level=1&rdquo;})</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L48">view source</a></div></div><div class="public anchor" id="var-parse-charset-accepted"><h3>parse-charset-accepted</h3><div class="usage"><code>(parse-charset-accepted v)</code></div><div class="doc"><div class="markdown"><p>Parses an <em>accept-charset</em> string to a list of [<em>charset</em> <em>quality-score</em>]</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L99">view source</a></div></div><div class="public anchor" id="var-preferred-charset"><h3>preferred-charset</h3><div class="usage"><code>(preferred-charset charsets)</code></div><div class="doc"><div class="markdown"><p>Returns an acceptable choice from a list of [<em>charset</em> <em>quality-score</em>]</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L113">view source</a></div></div><div class="public anchor" id="var-preferred-encoder"><h3>preferred-encoder</h3><div class="usage"><code>(preferred-encoder encoders req)</code></div><div class="doc"><div class="markdown"><p>Return the encoder that encodes to the most preferred type. If the <em>Accept</em> header of the request is a <em>String</em>, assume it is according to Ring spec. Else assume the header is a sequence of accepted types sorted by their preference. If no accepted encoder is found, return <em>nil</em>. If no <em>Accept</em> header is found, return the first encoder.</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L82">view source</a></div></div><div class="public anchor" id="var-wrap-clojure-response"><h3>wrap-clojure-response</h3><div class="usage"><code>(wrap-clojure-response handler &amp; {:keys [predicate encoder type charset hf handle-error], :or {predicate serializable?, encoder generate-native-clojure, type &quot;application/edn&quot;, charset default-charset-extractor, hf false, handle-error default-handle-error}})</code></div><div class="doc"><div class="markdown"><p>Wrapper to serialize structures in <em>:body</em> to Clojure native with sane defaults. If <em>:hf</em> is set to true, will use <em>print-dup</em> for high-fidelity printing ( see <a href="https://groups.google.com/d/msg/clojure/5wRBTPNu8qo/1dJbtHX0G-IJ">here</a> ). See <a href="ring.middleware.format-response.html#var-wrap-format-response">wrap-format-response</a> for more details.</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L230">view source</a></div></div><div class="public anchor" id="var-wrap-format-response"><h3>wrap-format-response</h3><div class="usage"><code>(wrap-format-response handler &amp; {:keys [predicate encoders charset binary? handle-error]})</code></div><div class="doc"><div class="markdown"><p>Wraps a handler such that responses body to requests are formatted to  the right format. If no <em>Accept</em> header is found, use the first encoder.</p>
<ul>
  <li><strong>:predicate</strong> is a predicate taking the request and response as  arguments to test if serialization should be used</li>
  <li><strong>:encoders</strong> a sequence of maps given by make-encoder</li>
  <li><strong>:charset</strong> can be either a string representing a valid charset or a fn  taking the req as argument and returning a valid charset  (*utf-8* is strongly suggested)</li>
  <li><strong>:binary?</strong> if true <em>:charset</em> will be ignored and decoder will receive  an <em>InputStream</em></li>
  <li><strong>:handle-error</strong> is a fn with a sig [exception request response]. Defaults  to just rethrowing the Exception</li>
</ul></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L159">view source</a></div></div><div class="public anchor" id="var-wrap-json-response"><h3>wrap-json-response</h3><div class="usage"><code>(wrap-json-response handler &amp; {:keys [predicate encoder type charset handle-error pretty], :or {predicate serializable?, pretty nil, type &quot;application/json&quot;, charset default-charset-extractor, handle-error default-handle-error}})</code></div><div class="doc"><div class="markdown"><p>Wrapper to serialize structures in <em>:body</em> to JSON with sane defaults. See <a href="ring.middleware.format-response.html#var-wrap-format-response">wrap-format-response</a> for more details.</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L199">view source</a></div></div><div class="public anchor" id="var-wrap-restful-response"><h3>wrap-restful-response</h3><div class="usage"><code>(wrap-restful-response handler &amp; {:keys [predicate handle-error formats charset binary?], :or {handle-error default-handle-error, predicate serializable?, charset default-charset-extractor, formats [:json :yaml :edn :clojure :yaml-in-html :transit-json :transit-msgpack]}})</code></div><div class="doc"><div class="markdown"><p>Wrapper that tries to do the right thing with the response <em>:body</em> and provide a solid basis for a RESTful API. It will serialize to JSON, YAML, Clojure, Transit or HTML-wrapped YAML depending on Accept header. See wrap-format-response for more details. Recognized formats are <em>:json</em>, <em>:json-kw</em>, <em>:edn</em> <em>:yaml</em>, <em>:yaml-in-html</em>, <em>:transit-json</em>, <em>:transit-msgpack</em>.</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L345">view source</a></div></div><div class="public anchor" id="var-wrap-transit-json-response"><h3>wrap-transit-json-response</h3><div class="usage"><code>(wrap-transit-json-response handler &amp; {:keys [predicate encoder type handle-error options], :or {predicate serializable?, type &quot;application/transit+json&quot;, handle-error default-handle-error}})</code></div><div class="doc"><div class="markdown"><p>Wrapper to serialize structures in <em>:body</em> to transit over <strong>JSON</strong> with sane defaults. See <a href="ring.middleware.format-response.html#var-wrap-format-response">wrap-format-response</a> for more details.</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L304">view source</a></div></div><div class="public anchor" id="var-wrap-transit-msgpack-response"><h3>wrap-transit-msgpack-response</h3><div class="usage"><code>(wrap-transit-msgpack-response handler &amp; {:keys [predicate encoder type handle-error options], :or {predicate serializable?, type &quot;application/transit+msgpack&quot;, handle-error default-handle-error}})</code></div><div class="doc"><div class="markdown"><p>Wrapper to serialize structures in <em>:body</em> to transit over <strong>msgpack</strong> with sane defaults. See <a href="ring.middleware.format-response.html#var-wrap-format-response">wrap-format-response</a> for more details.</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L318">view source</a></div></div><div class="public anchor" id="var-wrap-yaml-in-html-response"><h3>wrap-yaml-in-html-response</h3><div class="usage"><code>(wrap-yaml-in-html-response handler &amp; {:keys [predicate encoder type charset handle-error], :or {predicate serializable?, encoder wrap-yaml-in-html, type &quot;text/html&quot;, charset default-charset-extractor, handle-error default-handle-error}})</code></div><div class="doc"><div class="markdown"><p>Wrapper to serialize structures in <em>:body</em> to YAML wrapped in HTML to check things out in the browser. See <a href="ring.middleware.format-response.html#var-wrap-format-response">wrap-format-response</a> for more details.</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L273">view source</a></div></div><div class="public anchor" id="var-wrap-yaml-response"><h3>wrap-yaml-response</h3><div class="usage"><code>(wrap-yaml-response handler &amp; {:keys [predicate encoder type charset handle-error], :or {predicate serializable?, encoder yaml/generate-string, type &quot;application/x-yaml&quot;, charset default-charset-extractor, handle-error default-handle-error}})</code></div><div class="doc"><div class="markdown"><p>Wrapper to serialize structures in <em>:body</em> to YAML with sane defaults. See <a href="ring.middleware.format-response.html#var-wrap-format-response">wrap-format-response</a> for more details.</p></div></div><div class="src-link"><a href="http://github.com/metosin/ring-middleware-format/blob/master/src/ring/middleware/format_response.clj#L251">view source</a></div></div></div></body></html>